name: Build

on:
  workflow_call:
    inputs:
      image_name:
        type: string
        default: ${{ github.repository }}
      env:
        type: string
        required: true
      tags:
        type: string
        required: true

jobs:
  build:
    name: Build
    runs-on: ubuntu-latest

    env:
      REGISTRY: registry.docker.com

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Define Docker Images
        id: images
        run: |
          {
            echo "names<<EOF"
            while IFS= read -r tag; do
              if [[ -n "$tag" ]]; then
                echo "${{ env.REGISTRY }}/${{ inputs.env }}/${{ inputs.image_name }}:$tag"
              fi
            done <<< "${{ inputs.tags }}"
            echo "EOF"
          } >> $GITHUB_OUTPUT

      - name: Echo Tags
        run: echo 'Using tags ${{ inputs.tags }}'

      - name: Run Build
        run: echo 'Build ${{ inputs.env }} OK!'

      - name: Publish Artifact
        run: echo 'Publish ${{ steps.images.outputs.names }} OK!'
